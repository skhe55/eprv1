# Задача: Разработать сервис конвертации валют.

* Сервис парсит два источника, а именно центробанк России и Тайланда.
* Источники курсов:
1. ЦБ Тайланда: https://apiportal.bot.or.th/bot/public/node/503, API KEY: c2bbe063-d0ff-456c-bc08-fbd5115fb340.
2. ЦБ России: http://www.cbr.ru/scripts/XML_daily.asp

## Почему не использовал sql/nosql бд?
Мне показалось это оверхедом, у нас всего 2 простых эндпоинта и inmemory бд в контексте этой задачи хватает, учитывая что нам нужно хранить в памяти ~ 100 элементов

## Выбор архитектуры и таймаутов инвалидации данных
Архитектуру выбрал стандартную clean code (3 уровня: repository, delivery, usecase).
Методы взаимодействия с внешними источниками разделил и вынес их отдельно, т.к при добавлении еще нескольких центробанков неизвестно какие изменения нам нужно будет заимплементить в обобщенный метод, поэтому лучше из сразу разделить и если нам нужно будет когда-нибуть что то поменять в одном, то это не затронет все остальные.

* ReqInterval он же таймаут инвалидации данных, для центробанка РФ = 1 минута, для центробанка Тайланда = 1 час (можно гибко менять, сделано как пример)

## Описание работы

При старте приложения бд пуста и при первом же запросе /exchange или /convert мы пойдем в внешнее апи, все последующие запросы к одним и тем же центробанкам будут браться из бд, и только по истечению таймаута **reqInterval** мы обновим данные.
Если в бд есть данные по центробанку и еще не пришло время инвалидации, то для эндпоинтов /exchange и /convert будут браться данные из бд.

## Порты для работы приложения
:7878 - основное приложение
 
:8080 - сваггер дока

## Как запустить (prerequesite installed docker & docker-compose)
### Linux/Unix 
`make docker-setup`
### Windows
`docker-compose --file='./docker/api/docker-compose.yaml' up --remove-orphans --build -d`

## Как запустить без докера
`git clone https://github.com/skhe55/eprv1.git`

`go mod tidy`

`go install github.com/go-swagger/go-swagger/cmd/swagger@latest`

`go run ./cmd/app/main.go` / `make dev`

`go swagger serve --port=8080 --no-open -F=swagger ./docs/swagger.yaml`

